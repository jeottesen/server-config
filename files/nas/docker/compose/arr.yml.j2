{% include '_anchors.yml.j2' %}

services:

  prowlarr:
    extends:
      file: common.yml
      service: common-keys-apps-vpn
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    environment:
      <<: *primary-tz-puid-pgid
    volumes:
      - $CONTAINER_APPDATA_DIR/prowlarr:/config
    # traefik labels under wireguard

  recyclarr:
    extends:
      file: common.yml
      service: common-keys-apps
    image: recyclarr/recyclarr
    container_name: recyclarr
    user: '0:0'
    volumes:
      - $CONTAINER_APPDATA_DIR/recyclarr:/config

  sonarr:
    extends:
      file: common.yml
      service: common-keys-apps-vpn
    image: lscr.io/linuxserver/sonarr
    container_name: sonarr
    environment:
      <<: *primary-tz-puid-pgid
    volumes:
      - '$CONTAINER_APPDATA_DIR/sonarr:/config'
      - '$DATA_DIR:/data'
      - "/etc/localtime:/etc/localtime:ro"
      #Traefik labels under wireguard

  radarr:
    extends:
      file: common.yml
      service: common-keys-apps-vpn
    image: lscr.io/linuxserver/radarr
    container_name: radarr
    environment:
      <<: *primary-tz-puid-pgid
    volumes:
      - '$CONTAINER_APPDATA_DIR/radarr:/config'
      - '$DATA_DIR:/data'
      - "/etc/localtime:/etc/localtime:ro"
      #Traefik labels under wireguard

  # Readarr - Books management
  # Set url_base in readarr settings if using PathPrefix
  # readarr:
  #   extends:
  #     file: common.yml
  #     service: common-keys-apps-vpn
  #   image: lscr.io/linuxserver/readarr:develop
  #   container_name: readarr
  #   environment:
  #     <<: *primary-tz-puid-pgid
  #   volumes:
  #     - $CONTAINER_APPDATA_DIR/readarr:/config
  #     - $DATA_DIR:/data
  #     - "/etc/localtime:/etc/localtime:ro"
  #   #Traefik labels under wireguard

  overseerr:
    extends:
      file: common.yml
      service: common-keys-apps
    image: lscr.io/linuxserver/overseerr:latest
    container_name: overseerr
    environment:
      <<: *primary-tz-puid-pgid
    volumes:
      - $CONTAINER_APPDATA_DIR/overseerr:/config
          ### Overseer Routers
    labels:
      - "traefik.enable=true"
      ## HTTP Routers Auth Bypass
      - "traefik.http.routers.overseerr-rtr-bypass.entrypoints=websecure"
      - "traefik.http.routers.overseerr-rtr-bypass.rule=Host(`overseerr.$DOMAIN_NAME`) && Header(`Traefik-Auth-Key`, `$TRAEFIK_AUTH_KEY`)" # Bypass Auth for mobile apps
      - "traefik.http.routers.overseerr-rtr-bypass.priority=100"
      ## HTTP Routers
      - "traefik.http.routers.overseerr-rtr.entrypoints=websecure"
      - "traefik.http.routers.overseerr-rtr.rule=Host(`overseerr.$DOMAIN_NAME`)"
      - "traefik.http.routers.overseerr-rtr.priority=99"
      ## Middlewares
      - "traefik.http.routers.overseerr-rtr.middlewares=chain-oauth@file"
      ## HTTP Services
      - "traefik.http.routers.overseerr-rtr-bypass.service=overseerr-svc"
      - "traefik.http.routers.overseerr-rtr.service=overseerr-svc"
      - "traefik.http.services.overseerr-svc.loadbalancer.server.port=5055"

  {# # Lidarr - Music Management
  # Set url_base in lidarr settings if using PathPrefix
  lidarr:
    extends:
      file: common.yml
      service: common-keys-apps
    image: lscr.io/linuxserver/lidarr:latest
    container_name: lidarr
    #ports:
    #  - "$LIDARR_PORT:8686"
    volumes:
      - $CONTAINER_APPDATA_DIR/lidarr:/config
      - $DATA_DIR:/data
      - "/etc/localtime:/etc/localtime:ro"
    environment:
      <<: *default-tz-puid-pgid
    labels:
      - "traefik.enable=true"
      ## HTTP Routers Auth Bypass
      #- "traefik.http.routers.lidarr-rtr-bypass.entrypoints=https"
      #- "traefik.http.routers.lidarr-rtr-bypass.rule=Host(`lidarr.$DOMAIN_NAME`) && Header(`Traefik-Auth-Key`, `$TRAEFIK_AUTH_KEY`)" # Bypass Auth for mobile apps
      #- "traefik.http.routers.lidarr-rtr-bypass.priority=100"
      ## HTTP Routers Auth
      - "traefik.http.routers.lidarr-rtr.entrypoints=https"
      - "traefik.http.routers.lidarr-rtr.rule=Host(`lidarr.$DOMAIN_NAME`)"
      - "traefik.http.routers.lidarr-rtr.priority=99"
      ## Middlewares
      #- "traefik.http.routers.lidarr-rtr-bypass.middlewares=chain-no-auth@file"
      - "traefik.http.routers.lidarr-rtr.middlewares=chain-oauth@file"
      ## HTTP Services
      - "traefik.http.routers.lidarr-rtr.service=lidarr-svc"
      #- "traefik.http.routers.lidarr-rtr-bypass.service=lidarr-svc"
      - "traefik.http.services.lidarr-svc.loadbalancer.server.port=8686" #}
 
  unpackerr:
    extends:
      file: common.yml
      service: common-keys-apps
    image: golift/unpackerr
    container_name: unpackerr
    volumes:
      # You need at least this one volume mapped so Unpackerr can find your files to extract.
      # Make sure this matches your Starr apps; the folder mount (/downloads or /data) should be identical.
      - $CONTAINER_APPDATA_DIR/unpackerr:/config
      - $DATA_DIR:/data
    user: '$PUID:$PGID'
    # What you see below are defaults for this compose. You only need to modify things specific to your environment.
    # Remove apps and feature configs you do not use or need. 
    # ie. Remove all lines that begin with UN_CMDHOOK, UN_WEBHOOK, UN_FOLDER, UN_WEBSERVER, and other apps you do not use.
    environment:
      <<: *primary-tz-puid-pgid
      # General config
      UN_DEBUG: 'false'
      UN_LOG_FILES: '10'
      UN_LOG_FILE_MB: '10'
      UN_INTERVAL: '2m'
      UN_START_DELAY: '1m'
      UN_RETRY_DELAY: '5m'
      UN_MAX_RETRIES: '3'
      UN_PARALLEL: '1'
      UN_FILE_MODE: '0666'
      UN_DIR_MODE: '0777'
      # Sonarr Config
      UN_SONARR_0_URL: 'http://wireguard:8989'
      UN_SONARR_0_API_KEY: $SONARR_API_KEY
      UN_SONARR_0_PATHS_0: '/data/Torrents/private/complete/'
      UN_SONARR_0_PATHS_1: '/data/Torrents/public/complete/'
      UN_SONARR_0_PROTOCOLS: 'torrent'
      UN_SONARR_0_TIMEOUT: '10s'
      UN_SONARR_0_DELETE_ORIG: 'false'
      UN_SONARR_0_DELETE_DELAY: '480m'
      # Radarr Config
      UN_RADARR_0_URL: 'http://wireguard:7878'
      UN_RADARR_0_API_KEY: $RADARR_API_KEY
      UN_RADARR_0_PATHS_0: '/data/Torrents/private/complete/'
      UN_RADARR_0_PATHS_1: '/data/Torrents/public/complete/'
      UN_RADARR_0_PROTOCOLS: 'torrent'
      UN_RADARR_0_TIMEOUT: '10s'
      UN_RADARR_0_DELETE_ORIG: 'false'
      UN_RADARR_0_DELETE_DELAY: '480m'
